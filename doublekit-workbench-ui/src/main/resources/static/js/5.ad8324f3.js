(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{394:function(e,a,t){"use strict";t.r(a);t(241);var r=t(243),n=(t(242),t(244)),o=t(176),c=t.n(o),l=t(10),i=t.n(l),u=t(41),s=t.n(u),d=t(0),g=t.n(d),m=t(133),p=(t(132),t(63)),f=(t(246),t(245)),b=t(68),O=t(252),y=t(88),h=(t(250),t(249)),v=(t(312),t(303)),E=(t(253),t(251)),j=t(4);function w(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,r)}return t}function I(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?w(Object(t),!0).forEach((function(a){i()(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):w(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}var S={labelCol:{span:6},wrapperCol:{span:18}},P=function(e){var a=e.visible,t=e.cancelAddOrg,r=e.editData,n=void 0===r?{}:r,o=e.isEdit,l=void 0!==o&&o,i=e.getAllTree,u=e.rawDataTree,m=E.a.useForm(),p=s()(m,1)[0],O=Object(b.a)().t;Object(d.useEffect)((function(){l&&(p.setFieldsValue({parentOrga:n.parentOrga.orgaId}),p.setFieldsValue({orgaName:n.orgaName}))}),[l]);var w;return g.a.createElement(h.a,{title:l?O("orga-common.edit")+O("orga-common.orga"):O("orga-common.add")+O("orga-common.orga"),visible:a,onOk:function(){p.submit()},onCancel:function(){p.resetFields(),t()},closable:!1,destroyOnClose:!0,preserve:!1},g.a.createElement(E.a,c()({},S,{form:p,onFinish:function(e){var a="orga/createOrga",r={orgaName:e.orgaName,parentOrga:{orgaId:e.parentOrga}};l&&(a="orga/updateOrga",r=I(I({},r),{},{orgaId:n.orgaId})),y.a.post(a,r).then((function(e){e.code||(i(),p.resetFields(),t())}))}}),g.a.createElement(E.a.Item,{label:O("orga-label.orgaName"),name:"orgaName",rules:[{required:!0,message:"用户名不能包含非法字符，如&,%，&，#……等"}]},g.a.createElement(f.a,null)),g.a.createElement(E.a.Item,{label:O("orga-label.parentOrg"),name:"parentOrga",rules:[{required:!0,message:O("orga-label.parentOrgRequired")}]},g.a.createElement(v.a,{style:{width:"100%"},dropdownStyle:{maxHeight:400,overflow:"auto"},treeData:(w=[],function e(a,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];a.forEach((function(a){var o={};if(a.orgaId===n.orgaId){if(o={title:a.orgaName,value:a.orgaId,disabled:!0},t.push(o),a.children&&a.children.length>0)return e(a.children,o.children=[],o.disabled)}else o={title:a.orgaName,value:a.orgaId,disabled:r},t.push(o);if(a.children&&a.children.length>0)return e(a.children,o.children=[],r)}))}(Object(j.p)(u),w),w),placeholder:O("orga-label.parentOrgPlaceholder"),treeDefaultExpandedKeys:[u.length>0&&u[0].orgaId]}))))},D=Object(d.memo)(P),N=Object(m.c)((function(e){var a=e.classNameTree,t=e.treeData,r=e.onSelect,n=e.orgStore,o=e.getAllTree,l=n.deleteTree,i=Object(b.a)().t,u=Object(d.useState)(!1),m=s()(u,2),h=m[0],v=m[1],E=Object(d.useState)({}),j=s()(E,2),w=j[0],I=j[1],S=Object(d.useState)(!1),P=s()(S,2),N=P[0],k=P[1],x=function e(a){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return a.forEach((function(a){if(t.push({orgaId:a.orgaId,orgaName:a.orgaName}),a.children&&a.children.length>0)return e(a.children,t)})),t};return g.a.createElement("div",{className:"orga-tree-wrap ".concat(a)},g.a.createElement(f.a,{placeholder:i("orga-common.search")+i("orga-common.orga")+i("orga-common.name")}),g.a.createElement("div",{className:"orga-tree-wrap-tree"},g.a.createElement(O.d,{data:t,onSelect:r,defaultExpandedKeys:["key1","key1-2"],onDelete:function(e){var a=new FormData;a.append("id",e.orgaId),y.a.post("orga/deleteOrga",a).then((function(a){a.code||l(e.orgaId)}))},onEdit:function(e){var a=new FormData;a.append("id",e.orgaId),y.a.post("orga/findOrga",a).then((function(e){if(!e.code){x(t);I(e.data),k(!0),v(!0)}}))}})),g.a.createElement(p.a,{type:"primary",onClick:function(){x(t);v(!0)}},"+",i("orga-common.add")+i("orga-common.orga")),g.a.createElement(D,c()({},e,{visible:h,cancelAddOrg:function(){v(!1),I({}),k(!1)},editData:w,isEdit:N,getAllTree:o,rawDataTree:t})))})),k=(t(248),t(247)),x=(t(254),t(255)),C=(t(259),t(256)),T=(t(136),t(80)),A=t(140);function U(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,r)}return t}function F(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?U(Object(t),!0).forEach((function(a){i()(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):U(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function z(e,a){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,a){if(!e)return;if("string"==typeof e)return M(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return M(e,a)}(e))||a&&e&&"number"==typeof e.length){t&&(e=t);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,l=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return c=e.done,e},e:function(e){l=!0,o=e},f:function(){try{c||null==t.return||t.return()}finally{if(l)throw o}}}}function M(e,a){(null==a||a>e.length)&&(a=e.length);for(var t=0,r=new Array(a);t<a;t++)r[t]=e[t];return r}var K=function(e){var a=Object(b.a)().t,t=e.visible,o=e.onCancel,c=e.orgId,l=e.getOrgaUser,i=Object(d.useState)([]),u=s()(i,2),m=u[0],O=u[1],y=Object(d.useState)([]),v=s()(y,2),j=v[0],w=v[1],I=Object(d.useState)(10),S=s()(I,1)[0],P=Object(d.useState)(1),D=s()(P,2),N=D[0],x=D[1],C=Object(d.useState)(0),U=s()(C,2),M=U[0],K=U[1],R=Object(d.useState)({pageParam:{pageSize:S,currentPage:N}}),L=s()(R,2),q=L[0],J=L[1];Object(d.useEffect)((function(){V(q)}),[q]);var V=function(e){A.Axios.post("user/findUserPage",e).then((function(e){e.code||(K(e.data.totalRecord),w(e.data.dataList))}))},H=[{title:a("orga-table.surname"),dataIndex:"name",key:"name",width:"20%",ellipsis:!0},{title:a("orga-table.phone"),dataIndex:"phone",key:"phone",width:"20%",ellipsis:!0},{title:a("orga-table.email"),dataIndex:"email",key:"email",width:"20%",ellipsis:!0},{title:a("orga-table.org"),dataIndex:"org",key:"org",width:"20%",ellipsis:!0},{title:a("orga-table.type"),dataIndex:"userType",key:"userType",width:"10%",ellipsis:!0,render:function(e){switch(e){case 2:return a("orga-table.thirdparty");case 1:return a("orga-table.internal");default:return"--"}}}],$={selectedRowKeys:m,onChange:function(e){O(e)}};return g.a.createElement(h.a,{title:"选择用户",visible:t,onOk:function(){(function(){var e={orgaId:c,pageParam:{pageSize:9999999,currentPage:1}};return A.Axios.post("userOrga/findUserOrgaList",e)})().then((function(e){if(!e.code){var a,t=!1,r=e.data.map((function(e){return e.user.id})),n=z(m);try{var i=function(){var e=a.value;if(t)return"break";t=r.some((function(a){return e===a}))};for(n.s();!(a=n.n()).done;){if("break"===i())break}}catch(e){n.e(e)}finally{n.f()}if(t)return T.default.error("存在关联的用户");var u=m.map((function(e){return a={user:{id:e},orga:{orgaId:c}},A.Axios.post("userOrga/createUserOrga",a);var a}));Promise.all(u).then((function(e){J({pageParam:{pageSize:S,currentPage:1}}),O([]),x(1),K(0),o(),l({orgaId:c},1)}))}}))},onCancel:function(){J({pageParam:{pageSize:S,currentPage:1}}),O([]),x(1),K(0),o(),l({orgaId:c},1)},closable:!1,width:800,destroyOnClose:!0},g.a.createElement(r.a,null,g.a.createElement(n.a,{span:24},g.a.createElement(E.a,{layout:"inline",onFinish:function(e){},preserve:!1},g.a.createElement(E.a.Item,{name:"name",label:a("orga-table.name")},g.a.createElement(f.a,null)),g.a.createElement(E.a.Item,null,g.a.createElement(p.a,{type:"primary",htmlType:"submit"},a("orga-common.search")))))),g.a.createElement(r.a,null,g.a.createElement(n.a,{span:24},g.a.createElement("div",{style:{width:"100%"}},g.a.createElement(k.a,{columns:H,dataSource:j,rowSelection:$,rowKey:function(e){return e.id},pagination:{current:N,pageSize:S,total:M,onChange:function(e){x(e);var a=F(F({},a),{},{pageParam:{pageSize:S,currentPage:e}});J(a)}}})))))},R=Object(d.memo)(K),L=C.a.TabPane,q=function(e){var a=e.data,t=e.tableData,o=e.pagination,l=e.orgId,i=e.getOrgaUser,u=e.restTableData,m=Object(d.useMemo)((function(){return o}),[o]),O=Object(d.useMemo)((function(){return a}),[a]),h=Object(d.useMemo)((function(){return t}),[t]),v=Object(d.useMemo)((function(){return l}),[l]),E=Object(d.useState)(!1),j=s()(E,2),w=j[0],I=j[1],S=Object(b.a)().t,P=[{title:S("orga-table.name"),dataIndex:["user","name"]},{title:S("orga-table.account"),dataIndex:["orga","orgaName"]},{title:S("orga-table.orgaName"),dataIndex:["orga","parentOrga","orgaName"]},{title:S("orga-table.type"),dataIndex:["user","userType"],render:function(e){switch(e){case 2:return S("orga-table.thirdparty");case 1:return S("orga-table.internal");default:return"--"}}},{title:S("orga-common.action"),key:"action",render:function(e,a){return g.a.createElement(x.b,{size:"middle"},g.a.createElement("a",{onClick:function(){return D(a.id)}},S("orga-common.delete")))}}],D=Object(d.useCallback)((function(e){var a=new FormData;a.append("id",e),y.a.post("userOrga/deleteUserOrga",a).then((function(e){e.code||u(1)}))}),[]),N=Object(d.useCallback)((function(){I(!0)}),[]);return g.a.createElement("div",{className:"org-detail"},g.a.createElement(r.a,null,g.a.createElement(n.a,{span:12},g.a.createElement("div",{className:"org-detail-item"},g.a.createElement("label",null,S("orga-label.orgaName"),":"),g.a.createElement(f.a,{value:O.orgName,disabled:!0})))),g.a.createElement(r.a,null,g.a.createElement(n.a,{span:12},g.a.createElement("div",{className:"org-detail-item"},g.a.createElement("label",null,S("orga-label.parentOrg"),":"),g.a.createElement(f.a,{value:O.parentOrg,disabled:!0})))),g.a.createElement(r.a,null,g.a.createElement(n.a,{span:24},g.a.createElement("div",{className:"card-container"},g.a.createElement(C.a,{type:"card"},g.a.createElement(L,{tab:S("orga-label.user"),key:"1"},g.a.createElement(r.a,{justify:"space-between"},g.a.createElement(n.a,{span:6},g.a.createElement(f.a,{placeholder:S("orga-label.searchUser")})),g.a.createElement(n.a,{span:6},g.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},g.a.createElement(p.a,{type:"primary",onClick:N},"+",S("orga-label.addUser"))))),g.a.createElement(r.a,null,g.a.createElement(n.a,{span:24},g.a.createElement("div",{className:"org-detail-table"},g.a.createElement(k.a,{columns:P,dataSource:h,pagination:m,rowKey:function(e){return e.id},tableLayout:"fixed"}))))))))),g.a.createElement(R,c()({},e,{orgId:v,visible:w,onCancel:function(){return I(!1)},getOrgaUser:i})))},J=t(125);function V(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,r)}return t}a.default=Object(m.b)(J.a)(Object(m.c)((function(e){var a=e.orgStore,t=(e.selectMenu,a.treeData),o=a.selectData,l=a.getTree,u=a.selectTreeOrgDetail,m=Object(d.useState)(""),p=s()(m,2),f=p[0],b=p[1],h=Object(d.useState)(10),v=s()(h,1)[0],E=Object(d.useState)(1),j=s()(E,2),w=j[0],I=j[1],S=Object(d.useState)(0),P=s()(S,2),D=P[0],k=P[1],x=Object(d.useState)([]),C=s()(x,2),T=C[0],A=C[1],U=Object(d.useRef)(null);Object(d.useEffect)((function(){return U.current=!0,F(),function(){return U.current=!1}}),[]);var F=function(){y.a.post("orga/findOrgaTree").then((function(e){!e.code&&U.current&&(M({orgaId:e.data.orgaId}),l([e.data]),b(e.data.orgaId))}))},z=Object(d.useCallback)((function(e,a){var t=function(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?V(Object(t),!0).forEach((function(a){i()(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):V(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}({pageParam:{currentPage:a,pageSize:v}},e);y.a.post("userOrga/findUserOrgaPage",t).then((function(e){e.code||(k(e.data.totalRecord),A(e.data.dataList))}))}),[]),M=function(e){var a=new FormData;a.append("id",e.orgaId),y.a.post("orga/findOrga",a).then((function(a){a.code||(b(e.orgaId),I(1),u({orgName:a.data.orgaName,parentOrg:a.data.parentOrga?a.data.parentOrga.orgaName:null}),z({orgaId:e.orgaId},1))})).catch((function(e){console.log(e)}))},K=Object(d.useCallback)((function(e){I(e),z({orgaId:f},e)}),[]);return g.a.createElement(r.a,{justify:"center",style:{width:"100%"}},g.a.createElement(n.a,{xl:{span:24},xxl:{span:16}},g.a.createElement("div",{className:"org-parent"},g.a.createElement(N,c()({treeData:t,onSelect:M},e,{getAllTree:function(){y.a.post("orga/findOrgaTree").then((function(e){e.code||l([e.data])}))}})),g.a.createElement("div",{className:"org-parent-detail"},g.a.createElement(O.b,{routes:[{disabled:!0,breadcrumbName:"组织管理"},{path:"first",breadcrumbName:"组织详情"}]}),g.a.createElement(q,{data:o,tableData:T,pagination:{current:w,pageSize:v,total:D,onChange:K},orgId:f,getOrgaUser:z,restTableData:K})))))})))}}]);