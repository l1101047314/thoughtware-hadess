(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{396:function(e,t,n){"use strict";n.r(t);n(248);var r=n(247),a=(n(241),n(243)),i=(n(132),n(63)),l=(n(242),n(244)),c=(n(246),n(245)),o=n(10),u=n.n(o),p=(n(254),n(255)),s=n(41),d=n.n(s),m=n(0),f=n.n(m),g=n(133),v=n(88),b=n(68),h=n(252),j=n(176),O=n.n(j),E=(n(259),n(256)),y=(n(250),n(249)),P=(n(253),n(251));function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){u()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var k=function(e){var t=Object(b.a)().t,n=e.visible,o=e.onCancel,u=e.id,p=void 0===u?"":u,s=e.addSelectedRowKeys,g=e.userIDWidthId,h=e.domainId,j=Object(m.useState)([]),O=d()(j,2),E=O[0],w=O[1],k=Object(m.useState)([]),R=d()(k,2),D=R[0],I=R[1],F=Object(m.useState)(10),x=d()(F,1)[0],C=Object(m.useState)(1),N=d()(C,2),z=N[0],U=N[1],L=Object(m.useState)(0),K=d()(L,2),T=K[0],A=K[1],B={domainId:h,pageParam:{pageSize:x,currentPage:z}},J=Object(m.useState)(B),W=d()(J,2),G=W[0],q=W[1];Object(m.useEffect)((function(){H(G)}),[G]),Object(m.useEffect)((function(){w(s)}),[s]);var H=function(e){v.a.post("roleUser/findRoleUserPage",e).then((function(e){e.code||(A(e.data.totalRecord),I(e.data.dataList.map((function(e){return e.user}))))}))},M=function(){q({pageParam:{pageSize:x,currentPage:1}}),w([]),U(1),A(0),o()},Q=[{title:t("privilege-role.name"),dataIndex:"name",key:"name",width:"20%",ellipsis:!0},{title:t("privilege-role.phone"),dataIndex:"phone",key:"phone",width:"20%",ellipsis:!0},{title:t("privilege-role.email"),dataIndex:"email",key:"email",width:"20%",ellipsis:!0},{title:t("privilege-role.orga"),dataIndex:"org",key:"org",width:"20%",ellipsis:!0},{title:t("privilege-role.type"),dataIndex:"userType",key:"userType",width:"10%",ellipsis:!0,render:function(e){switch(e){case 2:return t("privilege-role.thirdparty");case 1:return t("privilege-role.internal");default:return"--"}}}],V={selectedRowKeys:E,onChange:function(e){w(e)},onSelect:function(e){var t,n="prjRoleUser/deletePrjRoleUser";E.some((function(t){return t===e.id}))?(t=new FormData).append("id",g[e.id]):(t={role:{id:p},user:{id:e.id}},n="prjRoleUser/createPrjRoleUser"),v.a.post(n,t)}};return f.a.createElement(y.a,{title:t("privilege-select-user"),visible:n,onOk:function(){M()},onCancel:M,closable:!1,width:800,destroyOnClose:!0},f.a.createElement(a.a,null,f.a.createElement(l.a,{span:24},f.a.createElement(P.a,{layout:"inline",onFinish:function(e){},preserve:!1},f.a.createElement(P.a.Item,{name:"name",label:t("privilege-user")},f.a.createElement(c.a,null)),f.a.createElement(P.a.Item,null,f.a.createElement(i.a,{type:"primary",htmlType:"submit"},t("privilege-search")))))),f.a.createElement(a.a,null,f.a.createElement(l.a,{span:24},f.a.createElement("div",{style:{width:"100%"}},f.a.createElement(r.a,{columns:Q,dataSource:D,rowSelection:V,rowKey:function(e){return e.id},pagination:{current:z,pageSize:x,total:T,onChange:function(e){U(e);var t=S(S({},t),{},{pageParam:{pageSize:x,currentPage:e}});q(t)}}})))))},R=function(e){var t=e.roleDetail,n=Object(b.a)().t,i=[{title:n("privilege-role.name"),dataIndex:["user","name"]},{title:n("privilege-role.phone"),dataIndex:["user","phone"]},{title:n("privilege-role.email"),dataIndex:["user","email"]},{title:n("privilege-role.type"),dataIndex:["user","userType"],render:function(e){switch(e){case 2:return n("privilege-role.thirdparty");case 1:return n("privilege-role.internal");default:return"--"}}},{title:n("privilege-common.action"),key:"action",render:function(e,t){return f.a.createElement(p.b,{size:"middle"},f.a.createElement("a",{onClick:function(){return N(t.id)}},n("privilege-common.delete")))}}],o=Object(m.useState)([]),u=d()(o,2),s=u[0],g=u[1],h=Object(m.useState)(!1),j=d()(h,2),E=j[0],y=j[1],P=Object(m.useState)([]),w=d()(P,2),S=w[0],R=w[1],D=Object(m.useState)({}),I=d()(D,2),F=I[0],x=I[1];Object(m.useEffect)((function(){C(t.id)}),[t]);var C=function(e){var t={roleId:e};v.a.post("prjRoleUser/findPrjRoleUserList",t).then((function(e){if(!e.code){g(e.data);var t=e.data.map((function(e){return e.user.id})),n=e.data.reduce((function(e,t){return e[t.user.id]=t.id,e}),{});R(t),x(n)}}))},N=function(e){var n=new FormData;n.append("id",e),v.a.post("prjRoleUser/deletePrjRoleUser",n).then((function(e){e.code||C(t.id)}))};return f.a.createElement(f.a.Fragment,null,f.a.createElement(a.a,null,f.a.createElement(l.a,{span:6},f.a.createElement(c.a,{placeholder:n("privilege-search")+n("privilege-user-and-org")})),f.a.createElement(l.a,{span:18})),f.a.createElement(a.a,null,f.a.createElement(l.a,{span:24},f.a.createElement(r.a,{columns:i,dataSource:s,rowKey:function(e){return e.id}}))),f.a.createElement(k,O()({},e,{visible:E,onCancel:function(){return y(!1),void C(t.id)},id:t.id,addSelectedRowKeys:S,userIDWidthId:F})))},D=n(78),I=n.n(D),F=(n(275),n(264));function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){u()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var N=F.a.Group,z=function(e){var t=e.roleDetail,n=e.group,r=Object(m.useState)([]),a=d()(r,2),i=a[0],l=a[1],c=Object(m.useState)({}),o=d()(c,2),u=o[0],p=o[1],s=Object(m.useState)({}),g=d()(s,2),b=g[0],h=g[1];Object(m.useEffect)((function(){t&&j()}),[t]);var j=function(){v.a.post("/prjFunction/findPrjFunctionList",{group:n}).then((function(e){if(!e.code){var n=O(e.data);l(n.result),p(n.resultChild),y(t.id,!0,n.result,n.resultChild)}}))},O=function(e){var t=e.map((function(e){return!e.parentFunction&&{value:e.id,label:e.name}})).filter(Boolean),n=e.map((function(e){return e.parentFunction&&e.parentFunction.id&&{value:e.id,label:e.name,parent:e.parentFunction.id}})).filter(Boolean),r=[],a={};return t.forEach((function(e){var t=e.value,i=n.filter((function(e){return e.parent===t}));r.push({value:e.value,label:e.label,indeterminate:!1,checkedList:[],checkAll:!1}),a[e.value]=i})),{result:r,resultChild:a}},E=function(e){var t=e.filter((function(e){return e.function&&e.function.parentFunction})).map((function(e){return{parentID:e.function.parentFunction.id,id:e.function.id}})),n=e.filter((function(e){return!e.function.parentFunction})).map((function(e){return e.function.id})),r={};return n.forEach((function(e){var n=t.map((function(t){if(t.parentID===e)return t.id})).filter(Boolean);r[e]=[].concat(I()(n),[e])})),r},y=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a={roleId:e};v.a.post("prjRoleFunction/findPrjRoleFunctionList",a).then((function(e){if(!e.code){var a=E(e.data),c=e.data.reduce((function(e,t){return e[t.function.id]=t.id,e}),{}),o=t?r:u,p=(t?n:i).map((function(e){var t=a[e.value]?a[e.value]:[],n=0===o[e.value].length,r=t.length===o[e.value].length+1&&0!==t.length,i=r?!r:!!t.length&&t.length<o[e.value].length+1;return n&&1===t.length&&(r=!0,i=!1),C(C({},e),{},{checkedList:t,indeterminate:i,checkAll:r})}));h(c),l(p)}}))},P=function(e,t){var n=t,r=i.filter((function(t){return t.value===e}))[0].checkedList,a=n.length<r.length,l=a?w(r,n):w(n,r);if(a)if(r.length>2){var c=l.filter((function(t){return t!==e}));c.map((function(e,t){k(e,t+1===c.length)}))}else{var o=Array.from(new Set(0===n.length?[e].concat(I()(l)):l));o.map((function(e,t){k(e,t+1===o.length)}))}else{var u=0===r.length?[e].concat(I()(l)):l;u.map((function(e,t){S(e,t+1===u.length)}))}},w=function(e,t){for(var n=[],r=function(r){var a=e[r];t.some((function(e){return e===a}))&&0!==t.length||n.push(a)},a=0;a<e.length;a++)r(a);return n},S=function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r={role:{id:t.id},function:{id:e}};v.a.post("prjRoleFunction/createPrjRoleFunction",r).then((function(e){n&&y(t.id)}))},k=function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=b[e],a=new FormData;a.append("id",r),v.a.post("prjRoleFunction/deletePrjRoleFunction",a).then((function(e){n&&y(t.id)}))};return f.a.createElement(f.a.Fragment,null,i.map((function(e){return f.a.createElement("div",{key:e.value},f.a.createElement(F.a,{indeterminate:e.indeterminate,onChange:function(t){return function(e,t){var n=Object.keys(b),r=n.includes(e),a=n.filter((function(t){return u[e].some((function(e){return e.value===t}))})),i=u[e].filter((function(e){if(!a.some((function(t){return t===e.value})))return e})),l=(!r||0!==u[e].length)&&u[e].length===i.length;if(r||(l=!0,i=u[e]),l)n.includes(e)||(i=[].concat(I()(i),[{value:e}])),i.length>0?i.map((function(e,t){S(e.value,t+1===i.length)})):S(e,!0);else{if(n.includes(e)){var c=a.map((function(e){return{value:e}}));i=[].concat(I()(c),[{value:e}])}i.length>0?i.map((function(e,t){k(e.value,t+1===i.length)})):k(e,!0)}}(e.value)},checked:e.checkAll},e.label),f.a.createElement("br",null),"       ",f.a.createElement(N,{options:u[e.value],value:e.checkedList,onChange:function(t){return function(e,t){P(e,t)}(e.value,t)}}))})))},U=E.a.TabPane,L=function(e){var t=e.roleDetailParams,n=e.clickBreadcrumb,r=Object(b.a)().t,i=Object(m.useState)({}),c=d()(i,2),o=c[0],u=c[1],p=[{click:n,breadcrumbName:"角色管理 "},{path:"/privilege/feature",breadcrumbName:"角色详情"}],s=Object(m.useRef)(null);Object(m.useEffect)((function(){return s.current=!0,t.id&&g(t.id),function(){return s.current=!1}}),[t]);var g=function(e){var t=new FormData;t.append("id",e),v.a.post("/prjRole/findPrjRole",t).then((function(e){!e.code&&s.current&&u(e.data)}))};return f.a.createElement("div",{className:"privilege-role-detail"},f.a.createElement(a.a,{justify:"center"},f.a.createElement(l.a,{xl:{span:20},lg:{span:24},xxl:{span:16}},f.a.createElement(h.b,{routes:p}),f.a.createElement("div",{className:"privilege-role-detail-container"},f.a.createElement(a.a,null,f.a.createElement(l.a,{span:6},f.a.createElement("div",{className:"privilege-role-detail-item"},f.a.createElement("label",null,r("privilege-role.roleName"),":"),"  ",f.a.createElement("span",null,o.name)))),f.a.createElement(a.a,null,f.a.createElement(l.a,{span:6},f.a.createElement("div",{className:"privilege-role-detail-item"},f.a.createElement("label",null,r("privilege-role.roleDesc"),":"),"  ",f.a.createElement("span",null,o.desc)))),f.a.createElement(a.a,null,f.a.createElement(l.a,{span:24},f.a.createElement("div",{className:"card-container"},f.a.createElement(E.a,{type:"card",defaultActiveKey:t.type},f.a.createElement(U,{tab:r("privilege-role.people"),key:"people"},f.a.createElement(R,O()({},e,{group:t.group,roleDetail:t}))),f.a.createElement(U,{tab:r("privilege-role.promise"),key:"promise"},f.a.createElement(z,O()({},e,{group:t.group,roleDetail:t})))))))))))},K=n(119);function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach((function(t){u()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.default=Object(g.b)(K.a)(Object(g.c)((function(e){var t=Object(b.a)().t,n=e.privilegeProjectRoleStore,o=e.group,u=void 0===o?"system":o,s=n.getDomainRoles,g=n.privilegeProjectRole,j=Object(m.useState)(!1),O=d()(j,2),E=O[0],y=O[1],P=Object(m.useState)({}),w=d()(P,2),S=w[0],k=w[1],R=Object(m.useState)(10),D=d()(R,1)[0],I=Object(m.useState)(1),F=d()(I,2),x=F[0],C=F[1],N=Object(m.useState)(0),z=d()(N,2),U=z[0],K=z[1],T=Object(m.useState)(null),B=d()(T,2),J=B[0],W=B[1],G=Object(m.useState)(!1),q=d()(G,2),H=q[0],M=q[1],Q={group:u,scope:1,pageParam:{pageSize:D,currentPage:x}},V=Object(m.useState)(Q),X=d()(V,2),Y=X[0],Z=X[1],$=Object(m.useRef)(null);Object(m.useEffect)((function(){return $.current=!0,re(Y),function(){return $.current=!1}}),[Y]);var _=[{title:t("privilege-role.roleName"),dataIndex:"name",render:function(e,t){return f.a.createElement("a",{onClick:function(){return ee(t.id,t.group,"people")}},e)}},{title:t("privilege-role.roleDesc"),dataIndex:"desc"},{title:t("privilege-role.people"),dataIndex:"people",render:function(e,t){return f.a.createElement("a",{onClick:function(){return ee(t.id,t.group,"people")}},e)}},{title:t("privilege-role.promise"),dataIndex:"promise",render:function(e,t){return f.a.createElement("a",{onClick:function(){return ee(t.id,t.group,"promise")}},e)}},{title:t("privilege-role.type"),dataIndex:"group",render:function(e,n){switch(e){case"system":return t("privilege-role.system");case"custom":default:return t("privilege-role.custom")}}},{title:t("privilege-common.action"),dataIndex:"action",render:function(e,n){return f.a.createElement(p.b,{size:"middle"},"custom"===n.group&&f.a.createElement("a",{onClick:function(){return ne(n)}},t("privilege-common.edit")),f.a.createElement("a",{onClick:function(){return te(n.id)}},t("privilege-common.delete")))}}],ee=function(e,t,n){W({id:e,group:t,type:n}),M(!0)},te=function(e){var t=new FormData;t.append("id",e),v.a.post("prjRole/deletePrjRole",t).then((function(e){e.code||re(Y)}))},ne=function(e){k(e),y(!0)},re=function(e){v.a.post("prjRole/findPrjRolePage",e).then((function(e){!e.code&&$.current&&(s(e.data.dataList),K(e.data.totalRecord))}))},ae=Object(m.useCallback)((function(){k({}),y(!1),re(Y)}),[E]);return f.a.createElement(f.a.Fragment,null,H?f.a.createElement(L,{roleDetailParams:J,clickBreadcrumb:M}):f.a.createElement("div",{className:"privilege-domain"},f.a.createElement(a.a,{justify:"center"},f.a.createElement(l.a,{xl:{span:20},lg:{span:24},xxl:{span:16}},f.a.createElement(h.b,{routes:[{disabled:!0,breadcrumbName:"角色管理 "},{path:"first",breadcrumbName:"角色列表"}]}),f.a.createElement("div",{className:"privilege-domain-container"},f.a.createElement(a.a,null,f.a.createElement(l.a,{span:6},f.a.createElement(c.a,{placeholder:t("privilege-common.please-input")+t("privilege-role.roleName"),onPressEnter:function(e){return function(e){Z({name:e.target.value,pageParam:{pageSize:D,currentPage:1}}),C(1)}(e)}})),f.a.createElement(l.a,{span:18},f.a.createElement("div",{className:"privilege-domain-btn"},f.a.createElement(i.a,{onClick:function(){y(!0)}},"+",t("privilege-role.addRole"))))),f.a.createElement(a.a,null,f.a.createElement(l.a,{span:24},f.a.createElement(r.a,{columns:_,dataSource:g,rowKey:function(e){return e.id},pagination:{current:x,pageSize:D,total:U},onChange:function(e,t,n){return function(e,t,n){C(e.current);var r=A(A({},Y),{},{orderParams:[],pageParam:{pageSize:D,currentPage:e.current}});Z(r)}(e)}})))))),f.a.createElement(h.e,{visible:E,cancel:ae,editData:S,group:u,urlType:"project"})))})))}}]);