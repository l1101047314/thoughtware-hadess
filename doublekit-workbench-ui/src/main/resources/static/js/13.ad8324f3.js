(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{397:function(e,t,n){"use strict";n.r(t);n(248);var r=n(247),a=(n(241),n(243)),i=(n(132),n(63)),l=(n(242),n(244)),c=(n(246),n(245)),o=n(10),u=n.n(o),s=(n(254),n(255)),p=n(41),d=n.n(p),m=n(0),f=n.n(m),g=n(133),v=n(68),b=n(176),h=n.n(b),E=(n(259),n(256)),O=n(252),y=(n(250),n(249)),j=(n(253),n(251)),w=n(88);function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach((function(t){u()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var k=function(e){var t=Object(v.a)().t,n=e.visible,o=e.onCancel,u=e.id,s=void 0===u?"":u,p=e.addSelectedRowKeys,g=e.userIDWidthId,b=Object(m.useState)([]),h=d()(b,2),E=h[0],O=h[1],S=Object(m.useState)([]),k=d()(S,2),D=k[0],I=k[1],F=Object(m.useState)(10),R=d()(F,1)[0],x=Object(m.useState)(1),C=d()(x,2),N=C[0],z=C[1],L=Object(m.useState)(0),U=d()(L,2),K=U[0],T=U[1],A=Object(m.useState)({pageParam:{pageSize:R,currentPage:N}}),B=d()(A,2),J=B[0],W=B[1];Object(m.useEffect)((function(){G(J)}),[J]),Object(m.useEffect)((function(){O(p)}),[p]);var G=function(e){w.a.post("user/findUserPage",e).then((function(e){e.code||(T(e.data.totalRecord),I(e.data.dataList))}))},q=function(){W({pageParam:{pageSize:R,currentPage:1}}),O([]),z(1),T(0),o()},H=[{title:t("privilege-role.name"),dataIndex:"name",key:"name",width:"20%",ellipsis:!0},{title:t("privilege-role.phone"),dataIndex:"phone",key:"phone",width:"20%",ellipsis:!0},{title:t("privilege-role.email"),dataIndex:"email",key:"email",width:"20%",ellipsis:!0},{title:t("privilege-role.org"),dataIndex:"org",key:"org",width:"20%",ellipsis:!0},{title:t("privilege-role.type"),dataIndex:"userType",key:"userType",width:"10%",ellipsis:!0,render:function(e){switch(e){case 2:return t("privilege-role.thirdparty");case 1:return t("privilege-role.internal");default:return"--"}}}],M={selectedRowKeys:E,onChange:function(e){O(e)},onSelect:function(e){var t,n="roleUser/deleteRoleUser";E.some((function(t){return t===e.id}))?(t=new FormData).append("id",g[e.id]):(t={role:{id:s},user:{id:e.id}},n="roleUser/createRoleUser"),w.a.post(n,t)}};return f.a.createElement(y.a,{title:t("privilege-select-user"),visible:n,onOk:function(){q()},onCancel:q,closable:!1,width:800},f.a.createElement(a.a,null,f.a.createElement(l.a,{span:24},f.a.createElement(j.a,{layout:"inline",onFinish:function(e){}},f.a.createElement(j.a.Item,{name:"name",label:t("privilege-user")},f.a.createElement(c.a,null)),f.a.createElement(j.a.Item,null,f.a.createElement(i.a,{type:"primary",htmlType:"submit"},t("privilege-search")))))),f.a.createElement(a.a,null,f.a.createElement(l.a,{span:24},f.a.createElement("div",{style:{width:"100%"}},f.a.createElement(r.a,{columns:H,dataSource:D,rowSelection:M,rowKey:function(e){return e.id},pagination:{current:N,pageSize:R,total:K,onChange:function(e){z(e);var t=P(P({},t),{},{pageParam:{pageSize:R,currentPage:e}});W(t)}}})))))},D=function(e){var t=e.roleDetail,n=Object(v.a)().t,o=[{title:n("privilege-role.name"),dataIndex:["user","name"]},{title:n("privilege-role.phone"),dataIndex:["user","phone"]},{title:n("privilege-role.email"),dataIndex:["user","email"]},{title:n("privilege-role.type"),dataIndex:["user","userType"],render:function(e){switch(e){case 2:return n("privilege-role.thirdparty");case 1:return n("privilege-role.internal");default:return"--"}}},{title:n("privilege-common.action"),key:"action",render:function(e,t){return f.a.createElement(s.b,{size:"middle"},f.a.createElement("a",{onClick:function(){return z(t.id)}},n("privilege-common.delete")))}}],u=Object(m.useState)([]),p=d()(u,2),g=p[0],b=p[1],E=Object(m.useState)(!1),O=d()(E,2),y=O[0],j=O[1],S=Object(m.useState)([]),P=d()(S,2),D=P[0],I=P[1],F=Object(m.useState)({}),R=d()(F,2),x=R[0],C=R[1];Object(m.useEffect)((function(){N(t.id)}),[t]);var N=function(e){var t={roleId:e};w.a.post("roleUser/findRoleUserList",t).then((function(e){if(!e.code){b(e.data);var t=e.data.map((function(e){return e.user.id})),n=e.data.reduce((function(e,t){return e[t.user.id]=t.id,e}),{});I(t),C(n)}}))},z=function(e){var n=new FormData;n.append("id",e),w.a.post("roleUser/deleteRoleUser",n).then((function(e){e.code||N(t.id)}))};return f.a.createElement(f.a.Fragment,null,f.a.createElement(a.a,null,f.a.createElement(l.a,{span:6},f.a.createElement(c.a,{placeholder:n("privilege-search")+n("privilege-user-and-org")})),f.a.createElement(l.a,{span:18},f.a.createElement("div",{className:"privilege-role-detail-btn"},f.a.createElement(i.a,{onClick:function(){j(!0)}},"+",n("privilege-add-user"))))),f.a.createElement(a.a,null,f.a.createElement(l.a,{span:24},f.a.createElement(r.a,{columns:o,dataSource:g,rowKey:function(e){return e.id}}))),f.a.createElement(k,h()({},e,{visible:y,onCancel:function(){return j(!1),void N(t.id)},id:t.id,addSelectedRowKeys:D,userIDWidthId:x})))},I=n(78),F=n.n(I),R=(n(275),n(264));function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){u()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var N=R.a.Group,z=function(e){var t=e.roleDetail,n=e.group,r=Object(m.useState)([]),a=d()(r,2),i=a[0],l=a[1],c=Object(m.useState)({}),o=d()(c,2),u=o[0],s=o[1],p=Object(m.useState)({}),g=d()(p,2),v=g[0],b=g[1];Object(m.useEffect)((function(){t&&h()}),[t]);var h=function(){w.a.post("/function/findFunctionList",{group:n}).then((function(e){if(!e.code){var n=E(e.data);l(n.result),s(n.resultChild),y(t.id,!0,n.result,n.resultChild)}}))},E=function(e){var t=e.map((function(e){return!e.parentFunction&&{value:e.id,label:e.name}})).filter(Boolean),n=e.map((function(e){return e.parentFunction&&e.parentFunction.id&&{value:e.id,label:e.name,parent:e.parentFunction.id}})).filter(Boolean),r=[],a={};return t.forEach((function(e){var t=e.value,i=n.filter((function(e){return e.parent===t}));r.push({value:e.value,label:e.label,indeterminate:!1,checkedList:[],checkAll:!1}),a[e.value]=i})),{result:r,resultChild:a}},O=function(e){var t=e.filter((function(e){return e.function&&e.function.parentFunction})).map((function(e){return{parentID:e.function.parentFunction.id,id:e.function.id}})),n=e.filter((function(e){return!e.function.parentFunction})).map((function(e){return e.function.id})),r={};return n.forEach((function(e){var n=t.map((function(t){if(t.parentID===e)return t.id})).filter(Boolean);r[e]=[].concat(F()(n),[e])})),r},y=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a={roleId:e};w.a.post("roleFunction/findRoleFunctionList",a).then((function(e){if(!e.code){var a=O(e.data),c=e.data.reduce((function(e,t){return e[t.function.id]=t.id,e}),{}),o=t?r:u,s=(t?n:i).map((function(e){var t=a[e.value]?a[e.value]:[],n=0===o[e.value].length,r=t.length===o[e.value].length+1&&0!==t.length,i=r?!r:!!t.length&&t.length<o[e.value].length+1;return n&&1===t.length&&(r=!0,i=!1),C(C({},e),{},{checkedList:t,indeterminate:i,checkAll:r})}));b(c),l(s)}}))},j=function(e,t){var n=t,r=i.filter((function(t){return t.value===e}))[0].checkedList,a=n.length<r.length,l=a?S(r,n):S(n,r);if(a)if(r.length>2){var c=l.filter((function(t){return t!==e}));c.map((function(e,t){k(e,t+1===c.length)}))}else{var o=Array.from(new Set(0===n.length?[e].concat(F()(l)):l));o.map((function(e,t){k(e,t+1===o.length)}))}else{var u=0===r.length?[e].concat(F()(l)):l;u.map((function(e,t){P(e,t+1===u.length)}))}},S=function(e,t){for(var n=[],r=function(r){var a=e[r];t.some((function(e){return e===a}))&&0!==t.length||n.push(a)},a=0;a<e.length;a++)r(a);return n},P=function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r={role:{id:t.id},function:{id:e}};w.a.post("roleFunction/createRoleFunction",r).then((function(e){n&&y(t.id)}))},k=function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=v[e],a=new FormData;a.append("id",r),w.a.post("roleFunction/deleteRoleFunction",a).then((function(e){n&&y(t.id)}))};return f.a.createElement(f.a.Fragment,null,i.map((function(e){return f.a.createElement("div",{key:e.value},f.a.createElement(R.a,{indeterminate:e.indeterminate,onChange:function(t){return function(e,t){var n=Object.keys(v),r=n.includes(e),a=n.filter((function(t){return u[e].some((function(e){return e.value===t}))})),i=u[e].filter((function(e){if(!a.some((function(t){return t===e.value})))return e})),l=(!r||0!==u[e].length)&&u[e].length===i.length;if(r||(l=!0,i=u[e]),l)n.includes(e)||(i=[].concat(F()(i),[{value:e}])),i.length>0?i.map((function(e,t){P(e.value,t+1===i.length)})):P(e,!0);else{if(n.includes(e)){var c=a.map((function(e){return{value:e}}));i=[].concat(F()(c),[{value:e}])}i.length>0?i.map((function(e,t){k(e.value,t+1===i.length)})):k(e,!0)}}(e.value)},checked:e.checkAll},e.label),f.a.createElement("br",null),"       ",f.a.createElement(N,{options:u[e.value],value:e.checkedList,onChange:function(t){return function(e,t){j(e,t)}(e.value,t)}}))})))},L=E.a.TabPane,U=function(e){var t=e.roleDetailParams,n=e.clickBreadcrumb,r=Object(v.a)().t,i=Object(m.useState)({}),c=d()(i,2),o=c[0],u=c[1],s=[{click:n,breadcrumbName:"角色管理 "},{path:"/privilege/feature",breadcrumbName:"角色详情"}],p=Object(m.useRef)(null);Object(m.useEffect)((function(){return p.current=!0,t.id&&g(t.id),function(){return p.current=!1}}),[t]);var g=function(e){var t=new FormData;t.append("id",e),w.a.post("/role/findRole",t).then((function(e){!e.code&&p.current&&u(e.data)}))};return f.a.createElement("div",{className:"privilege-role-detail"},f.a.createElement(a.a,{justify:"center",className:"privilege-role-detail-wrap"},f.a.createElement(l.a,{xl:{span:20},lg:{span:24},xxl:{span:16},className:"privilege-role-detail-col"},f.a.createElement(O.b,{routes:s}),f.a.createElement("div",{className:"privilege-role-detail-container"},f.a.createElement(a.a,null,f.a.createElement(l.a,{span:6},f.a.createElement("div",{className:"privilege-role-detail-item"},f.a.createElement("label",null,r("privilege-role.roleName"),":"),"  ",f.a.createElement("span",null,o.name)))),f.a.createElement(a.a,null,f.a.createElement(l.a,{span:6},f.a.createElement("div",{className:"privilege-role-detail-item"},f.a.createElement("label",null,r("privilege-role.roleDesc"),":"),"  ",f.a.createElement("span",null,o.desc)))),f.a.createElement(a.a,null,f.a.createElement(l.a,{span:24},f.a.createElement("div",{className:"card-container"},f.a.createElement(E.a,{type:"card",defaultActiveKey:t.type},f.a.createElement(L,{tab:r("privilege-role.people"),key:"people"},f.a.createElement(D,h()({},e,{group:t.group,roleDetail:t}))),f.a.createElement(L,{tab:r("privilege-role.promise"),key:"promise"},f.a.createElement(z,h()({},e,{group:t.group,roleDetail:t})))))))))))},K=n(118);function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach((function(t){u()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.default=Object(g.b)(K.a)(Object(g.c)((function(e){var t=Object(v.a)().t,n=e.systemRoleStore,o=n.getRoles,u=n.privilegeSystemRole,p=Object(m.useState)(!1),g=d()(p,2),b=g[0],h=g[1],E=Object(m.useState)({}),y=d()(E,2),j=y[0],S=y[1],P=Object(m.useState)(10),k=d()(P,1)[0],D=Object(m.useState)(1),I=d()(D,2),F=I[0],R=I[1],x=Object(m.useState)(0),C=d()(x,2),N=C[0],z=C[1],L=Object(m.useState)(null),K=d()(L,2),T=K[0],B=K[1],J=Object(m.useState)(!1),W=d()(J,2),G=W[0],q=W[1],H=Object(m.useState)(""),M=d()(H,2),Q=M[0],V=M[1],X={pageParam:{pageSize:k,currentPage:F}},Y=Object(m.useState)(X),Z=d()(Y,2),$=Z[0],_=Z[1],ee=Object(m.useRef)(null);Object(m.useEffect)((function(){return ee.current=!0,ie($),function(){return ee.current=!1}}),[$]);var te=[{title:t("privilege-role.roleName"),dataIndex:"name",render:function(e,t){return f.a.createElement("a",{onClick:function(){return ne(t.id,t.group,"people")}},e)}},{title:t("privilege-role.roleDesc"),dataIndex:"desc"},{title:t("privilege-role.people"),dataIndex:"people",render:function(e,t){return f.a.createElement("a",{onClick:function(){return ne(t.id,t.group,"people")}},e)}},{title:t("privilege-role.promise"),dataIndex:"promise",render:function(e,t){return f.a.createElement("a",{onClick:function(){return ne(t.id,t.group,"promise")}},e)}},{title:t("privilege-role.type"),dataIndex:"group",render:function(e,n){switch(e){case"system":return t("privilege-role.system");case"custom":default:return t("privilege-role.custom")}}},{title:t("privilege-common.action"),dataIndex:"action",render:function(e,n){return f.a.createElement(s.b,{size:"middle"},f.a.createElement("a",{onClick:function(){return ae(n)}},t("privilege-common.edit")),f.a.createElement("a",{onClick:function(){return re(n.id)}},t("privilege-common.delete")))}}],ne=function(e,t,n){B({id:e,group:t,type:n}),q(!0)},re=function(e){var t=new FormData;t.append("id",e),w.a.post("role/deleteRole",t).then((function(e){e.code||ie($)}))},ae=function(e){S(e),h(!0)},ie=function(e){w.a.post("role/findRolePage",e).then((function(e){!e.code&&ee.current&&(o(e.data.dataList),z(e.data.totalRecord))}))},le=Object(m.useCallback)((function(){S({}),h(!1),ie($)}),[b]),ce=function(e){V(e),h(!0)};return f.a.createElement(f.a.Fragment,null,G?f.a.createElement(U,{roleDetailParams:T,clickBreadcrumb:q}):f.a.createElement("div",{className:"privilege"},f.a.createElement(a.a,{justify:"center",className:"privilege-wrap"},f.a.createElement(l.a,{xl:{span:20},lg:{span:24},xxl:{span:16},className:"role-col"},f.a.createElement(O.b,{routes:[{disabled:!0,breadcrumbName:"角色管理 "},{path:"first",breadcrumbName:"角色列表"}]}),f.a.createElement("div",{className:"privilege-container"},f.a.createElement(a.a,null,f.a.createElement(l.a,{span:6},f.a.createElement(c.a,{placeholder:t("privilege-common.please-input")+t("privilege-role.roleName"),onPressEnter:function(e){return function(e){_({name:e.target.value,pageParam:{pageSize:k,currentPage:1}}),R(1)}(e)}})),f.a.createElement(l.a,{span:18},f.a.createElement("div",{className:"privilege-btn"},f.a.createElement(i.a,{onClick:function(){return ce("system")}},"+",t("privilege-role.addSystemRole")),f.a.createElement(i.a,{onClick:function(){return ce("custom")}},"+",t("privilege-role.addRole"))))),f.a.createElement(a.a,null,f.a.createElement(l.a,{span:24},f.a.createElement(r.a,{columns:te,dataSource:u,rowKey:function(e){return e.id},pagination:{current:F,pageSize:k,total:N},onChange:function(e,t,n){return function(e,t,n){R(e.current);var r=A(A({},$),{},{orderParams:[],pageParam:{pageSize:k,currentPage:e.current}});_(r)}(e)}})))))),f.a.createElement(O.e,{visible:b,cancel:le,editData:j,group:Q,urlType:"system"})))})))}}]);